{# @var item \BaksDev\Ozon\Package\Repository\Supply\OzonPackageOrdersByOzonSupply\OzonPackageOrdersByOzonSupplyResult #}

{% set dedline = date(item.orderData)|date_modify("+24 hours") %}
{% set difference = dedline.diff(date("now")) %}
{% set hour = difference.d * 24 + difference.h %}

<div class="card bg-light-primary rounded-4">

    <div class="card-body small p-2">

        <div class="d-flex justify-content-between">

            <div class="d-flex align-items-center gap-1 text-primary pointer copy small"
                 data-copy="{{ item.orderNumber }}">

                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="14"
                     height="14" fill="currentColor" viewBox="0 0 115.77 122.88">
                    <path d="M89.62,13.96v7.73h12.19h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02v0.02 v73.27v0.01h-0.02c-0.01,3.84-1.57,7.33-4.1,9.86c-2.51,2.5-5.98,4.06-9.82,4.07v0.02h-0.02h-61.7H40.1v-0.02 c-3.84-0.01-7.34-1.57-9.86-4.1c-2.5-2.51-4.06-5.98-4.07-9.82h-0.02v-0.02V92.51H13.96h-0.01v-0.02c-3.84-0.01-7.34-1.57-9.86-4.1 c-2.5-2.51-4.06-5.98-4.07-9.82H0v-0.02V13.96v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07V0h0.02h61.7 h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02V13.96L89.62,13.96z M79.04,21.69v-7.73v-0.02h0.02 c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v64.59v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h12.19V35.65 v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07v-0.02h0.02H79.04L79.04,21.69z M105.18,108.92V35.65v-0.02 h0.02c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v73.27v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h61.7h0.02 v0.02c0.91,0,1.75-0.39,2.37-1.01c0.61-0.61,1-1.46,1-2.37h-0.02V108.92L105.18,108.92z"></path>
                </svg>

                <span> # {{ item.orderNumber }}</span>
            </div>
        </div>

        {% if supply.status != 'close' %}

            <div class="d-flex justify-content-between mt-1">
                <div class="text-muted d-flex justify-content-between w-100">

                    {#  Просрочен или Опоздание #}
                    {% if (dedline < date("now")) or (hour < 8) %}

                        {% if dedline < date("now") %}
                            <span class="badge bg-danger small p-1">
                                Просрочен
                            </span>

                            <strong class="blink">
                                {{ hour }} ч. {{ difference.i }} м.
                            </strong>
                        {% else %}
                            <span class="badge bg-warning text-dark small p-1">
                                Опоздание
                            </span>

                            <strong class="text-danger">
                                {{ hour }} ч. {{ difference.i }} м.
                            </strong>
                        {% endif %}

                    {% else %}

                        <strong>Время на доставку:</strong>
                        <strong class="text-success">
                            {{ hour }} ч. {{ difference.i }} м.
                        </strong>
                    {% endif %}

                </div>
            </div>

        {% endif %}

    </div>

    {# Обложка #}
    <div class="d-flex flex-column small gap-1 p-2 bg-cover lazy col-2 w-100 position-relative"
         style=" height: 200px;"
         data-bg="{{ cdn_image_path(item.productImage, item.productImageExt, item.productImageCdn) }}">

        {% if  part %}
            <div class="icon rounded-circle bg-contain p-1 mb-2 shadow position-absolute"
                 style="width: 25px; height: 25px;">
                {{ include(_self|replace({ "card.html.twig": "_usecase.html.twig" })) }}
            </div>
        {% endif %}

    </div>

    <div class="card-body d-flex flex-column p-2">

        <div class="text-truncate bg-contain"
             role="tooltip"
             data-bs-toggle="tooltip"
             data-bs-placement="top"
             data-bs-delay='{"show":600,"hide":100}'
             title="{{ item.productName }}">

            <a href="{# {{ (is_granted(ROLE~'_EDIT') or is_granted('ROLE_ADMIN')) ? path('products-product:admin.newedit.edit', { id: item.event }) }} #}"
               class="fw-bolder mb-1 text-dark text-decoration-none">
                {{ item.productName|capitalize }}
            </a>
        </div>


        <div class="text-muted fw-bolder">

            {# Значение множественного варианта ТП #}
            {{ item.productVariationValue|call_twig_func(item.productVariationReference~'_render') ~
            item.productModificationValue|call_twig_func(item.productModificationReference~'_render') }}

            {# Значение торгового предложения #}
            {{ item.productOfferValue|call_twig_func(item.productOfferReference~'_render') }}

            {# Постфикс торгового предложения #}
            {{ item.productOfferPostfix }}
            {# Постфикс множественного варианта #}
            {{ item.productVariationPostfix }}
            {# Постфикс модификации #}
            {{ item.productModificationPostfix }}

        </div>

        <div class="d-flex justify-content-between align-items-center small">

            <div class="d-flex align-items-center gap-1 text-primary pointer copy small"
                 data-copy="{{ item.productArticle }}">

                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="14"
                     height="14" fill="currentColor" viewBox="0 0 115.77 122.88">
                    <path d="M89.62,13.96v7.73h12.19h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02v0.02 v73.27v0.01h-0.02c-0.01,3.84-1.57,7.33-4.1,9.86c-2.51,2.5-5.98,4.06-9.82,4.07v0.02h-0.02h-61.7H40.1v-0.02 c-3.84-0.01-7.34-1.57-9.86-4.1c-2.5-2.51-4.06-5.98-4.07-9.82h-0.02v-0.02V92.51H13.96h-0.01v-0.02c-3.84-0.01-7.34-1.57-9.86-4.1 c-2.5-2.51-4.06-5.98-4.07-9.82H0v-0.02V13.96v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07V0h0.02h61.7 h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02V13.96L89.62,13.96z M79.04,21.69v-7.73v-0.02h0.02 c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v64.59v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h12.19V35.65 v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07v-0.02h0.02H79.04L79.04,21.69z M105.18,108.92V35.65v-0.02 h0.02c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v73.27v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h61.7h0.02 v0.02c0.91,0,1.75-0.39,2.37-1.01c0.61-0.61,1-1.46,1-2.37h-0.02V108.92L105.18,108.92z"></path>
                </svg>

                <small>{{ item.productArticle }}</small>
            </div>

            <div>

                {% if part %}
                    <span role="tooltip"
                          data-bs-toggle="tooltip"
                          data-bs-placement="bottom"
                          title='{{ item.print == false ? 'Печать стикеров заказа' : 'Печать уже выполнена' }}'>

                            <button data-href="{{ path('ozon-package:admin.package.print.order', { id: item.orderId, print: true }) }}"
                                    class="btn btn-sm disabled prnt {{ item.print == false ? 'btn-primary' : 'btn-light text-dark' }}"

                                    data-bs-toggle="modal"
                                    data-bs-target="#modal">

                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                         class="bi bi-printer-fill" viewBox="0 0 16 16">
                                      <path d="M5 1a2 2 0 0 0-2 2v1h10V3a2 2 0 0 0-2-2H5zm6 8H5a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1z"/>
                                      <path d="M0 7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-1v-2a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2H2a2 2 0 0 1-2-2V7zm2.5 1a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/>
                                    </svg>
                                </button>

                        </span>
                {% else %}

                    <span role="tooltip"
                          data-bs-toggle="tooltip"
                          data-bs-placement="bottom"
                          title='Заказ № {{ item.orderNumber }}'>

                                <button class="btn btn-sm disabled btn-light text-dark" disabled>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                         class="bi bi-box-seam" viewBox="0 0 16 16">
                                      <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2zm3.564 1.426L5.596 5 8 5.961 14.154 3.5zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z"/>
                                    </svg>
                                </button>

                        </span>

                {% endif %}


            </div>

        </div>


    </div>
</div>

